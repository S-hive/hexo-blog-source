---
title: SSH概念
date: 2025-07-15
cssclasses:
  - Serve
  - SSH
---

SSH（Secure Shell）是一种用于在网络中安全远程登录和执行命令的协议
### **一、SSH 的正常通信流程**

1. **密钥交换**：客户端发起连接后，服务器向客户端发送**公钥**（用于加密后续通信）。
2. **身份验证**：客户端验证服务器公钥的合法性（首次连接时会弹窗提示用户确认公钥指纹，后续连接则比对本地缓存）。
3. **加密通信**：验证通过后，双方**基于公钥协商对称加密密钥，后续数据通过该密钥加密传输**[[SSH概念#关于加密]]，确保私密性和完整性。
#### 关于加密 

**一. 公钥与私钥 —— “公钥相当于一个锁，私钥就是解开这个锁的钥匙”** 

1. **公钥（锁）与私钥（钥匙）的角色**
	- **公钥（锁）**：可以公开传递，任何人都能获取。就像一把挂在门外的锁，别人可以用它锁东西，但只有钥匙的持有者才能打开。
	- **私钥（钥匙）**：必须严格保密，仅持有者拥有。用公钥加密的数据，只有对应的私钥才能解密（就像用锁锁上的盒子，只有钥匙能打开）。

**二. 非对称加密和对称加密 —— “结合了非对称加密和对称加密”**

 1. SSH 的加密机制包含**非对称加密（用于安全协商）** 和**对称加密（用于数据传输）** 两个核心环节,两者配合完成整个加密流程:

	- **非对称加密**：主要用于**身份验证和建立安全连接的初始阶段**。  
	    比如常见的 “公钥登录” 方式，就是通过一对非对称密钥（公钥存于服务器，私钥由客户端持有）验证客户端身份，确保连接发起方是合法用户。此外，SSH 握手时会用非对称加密协商后续对称加密的密钥（避免密钥在网络中明文传输）。
    
	- **对称加密**：用于**连接建立后的实际数据传输**。  
	    因为非对称加密计算量大，不适合大量数据传输，所以 SSH 会在握手阶段通过非对称加密协商出一个临时的对称密钥，后续所有数据都用这个对称密钥加密，兼顾安全性和效率。

2. **对称加密与非对称加密的核心区别**

| **对比维度**    | **对称加密**                   | **非对称加密**                          |
| ----------- | -------------------------- | ---------------------------------- |
| **密钥数量与使用** | 只有**1 个密钥**（对称密钥），加密和解密都用它 | 有**2 个密钥**（公钥 + 私钥），公钥加密、私钥解密（或反之） |
| **密钥特性**    | 密钥必须**严格保密**，且双方需提前共享      | 公钥可**公开传播**，私钥必须保密                 |
| **加密解密效率**  | 速度极快（适合大量数据）               | 速度较慢（适合小数据）                        |
| **典型算法**    | AES、DES、RC4                | RSA、ECDH、DSA                       |
| **核心场景**    | 实际数据传输（如文件、会话内容）           | 密钥交换、身份认证（如 SSH 公钥验证）              |

3. **混淆 “公钥” 和 “对称加密”？—— 对称加密中没有 “公钥” 概念，公钥是 “非对称加密” 的核心要素**
	- **公钥**属于非对称加密体系，用于**安全传递对称密钥**；
	- 对称加密用的是单独的**对称密钥**，用于**高效传输实际数据**。

#### 公钥私钥谁持有？

- 服务器有自己的公钥（给客户端用）和私钥（自己留着）；
- 客户端（若用密钥登录）也有自己的公钥（给服务器用）和私钥（自己留着）。  
双方通过交换公钥，用对方的公钥加密信息，再用自己的私钥解密，完成安全交互。

### **二、中间人攻击**

SSH（Secure Shell）的中间人攻击（Man-in-the-Middle Attack，简称 MITM）是一种针对 SSH 加密通信的网络攻击手段，攻击者通过秘密介入客户端与服务器之间的通信，伪装成 “中间人” 窃取或篡改数据，同时让双方误以为正在直接通信。以下是详细解释：

1. **原理**
	1. **拦截连接**：攻击者通过网络劫持（如 ARP 欺骗、DNS 劫持等），让客户端的连接请求发送        到自己的设备，而非目标服务器。
	2. **双重伪装**：
	    - 攻击者向客户端发送**自己的公钥**（伪装成服务器的公钥）。
	    - 同时，攻击者以客户端的身份连接目标服务器，获取服务器的真实公钥。
	1. **数据转发与窃听**：
	    - 客户端用攻击者的公钥加密数据后发送，攻击者解密并获取原始数据。
	    - 攻击者再用服务器的真实公钥加密数据，转发给服务器；反之亦然。
	2. **隐藏痕迹**：客户端和服务器均无法察觉中间人的存在，误以为在直接通信。

2. **攻击成功的关键条件**

	中间人攻击能得逞，核心在于**绕过 SSH 的公钥验证机制，采用密码认证**：
		- **首次连接**：用户对服务器公钥的指纹（如`SHA256:xxxx`）缺乏认知，可能直接点击 “确认”（忽略安全提示），导致接受攻击者伪造的公钥。
		- **非首次连接**：攻击者通过技术手段（如修改客户端本地缓存的公钥记录），让客户端误以为服务器公钥未发生变化，从而跳过验证。

3. **如何防范中间人攻击 —— 严格验证服务器公钥的合法性，并采用更安全的认证方式（如密钥认证）** 
  
	 1. **严格验证公钥指纹**：
	    - 首次连接服务器时，务必通过**可信渠道**（如线下、加密邮件）获取服务器公钥的指纹，与客户端显示的指纹比对，确认一致后再确认。
	    - 非首次连接时，若客户端提示 “公钥已更改”（可能是攻击或服务器真的更换了公钥），需暂停连接并排查原因。
	    
	2. **使用密钥认证替代密码认证**：
	    - SSH 密钥认证（公钥 - 私钥对）比密码认证更安全，即使中间人截获数据，也无法获取私钥（私钥仅存储在客户端）。
	    
	3. **限制 SSH 访问范围**：
	    - 通过防火墙或 SSH 配置（如`sshd_config`）限制允许连接的 IP 地址，减少被攻击的暴露面。
	    
	4. **使用额外安全机制**：
	    - 启用 SSH 的**主机密钥验证**（`StrictHostKeyChecking yes`），拒绝连接未知或公钥变化的服务器。
	    - 结合 VPN 或专用网络，减少中间人劫持的可能性。
