---
title: SSH面试
cssclasses:
  - Serve
  - SSH
---
#### 服务的底层原理是什么？
>SSH（Secure Shell）服务是一种用于在网络中安全远程登录和执行命令的协议，其底层原理围绕**加密通信**、**身份认证**和**数据完整性校验**展开，旨在解决传统明文协议（如 Telnet、FTP）的安全漏洞。
1. **加密技术**
	*  **非对称加密（公钥加密）**
	* **对称加密（共享密钥加密）**：
2. **身份认证**
	* **密码认证**
	* **公钥认证** : 客户端提前将自己的公钥存入服务器的`~/.ssh/authorized_keys`文件中。连接时，服务器生成随机字符串并用客户端公钥加密，客户端用私钥解密后发回服务器，服务器验证解密结果是否匹配，无需传输密码，安全性更高。
	*  **主机密钥认证**：首次连接时，服务器发送自己的主机公钥，客户端确认后保存（`~/.ssh/known_hosts`），后续连接验证主机身份，防止中间人攻击。
3. **数据完整性校验**
#### 有什么软件或者服务跟要学习的服务类似，他们的异同点是什么，是否可以替代，不可替代点是什么？
| 软件 / 服务        | 核心功能                   | 与 SSH 的相同点              | 与 SSH 的不同点                                                |
| -------------- | ---------------------- | ----------------------- | --------------------------------------------------------- |
| **FinalShell** | 远程登录、文件传输、服务器监控        | 基于 SSH 协议，支持加密传输和远程命令执行 | 集成图形化监控面板、进程管理、服务器性能分析；资源占用较高（依赖 JVM）                     |
| **WindTerm**   | 轻量远程终端、文件传输            | 基于 SSH 协议，支持多会话管理和加密通信  | 轻量级（启动仅需几 MB 内存），支持标签页、分屏；无多余功能，专注终端体验                    |
| **Termius**    | 跨平台远程终端、会话同步           | 基于 SSH 协议，支持密钥认证和文件传输   | 支持 Windows/macOS/Linux/iOS/Android 跨平台同步；提供触控优化界面（移动设备友好） |
| **MobaXterm**  | 集成多协议远程工具（SSH/RDP/VNC） | 支持 SSH 核心功能，加密传输和命令交互   | 集成 RDP、VNC、FTP 等协议；提供 X 服务器功能、图形化 SFTP 文件管理器              |
| **Telnet**     | 远程终端协议（无加密）            | 支持远程命令执行和终端交互           | 明文传输（无加密），安全性极低；协议简单，兼容性极老设备                              |
| **RDP（远程桌面）**  | 图形化远程桌面控制              | 支持远程系统操作                | 基于图形化界面（非命令行），依赖 Windows 系统；传输效率高但协议封闭                    |
| **VNC**        | 跨平台图形化远程控制             | 支持远程系统操作                | 基于图形化界面，开源协议；传输效率较低，需额外加密（如配合 SSH 隧道）                     |

#### 我们在公司里都会在哪些场景下使用
| 场景           | 具体用途                         | 示例 / 工具                                                                                   |
| ------------ | ---------------------------- | ----------------------------------------------------------------------------------------- |
| **远程服务器管理**  | 通过命令行执行系统操作（如部署服务、修改配置、监控进程） | `ssh user@server` + 命令（`systemctl`, `vim`, `top`）                                         |
| **自动化运维**    | 结合脚本批量执行任务（如更新软件包、同步配置）      | Shell 脚本 + `sshpass` 或 Ansible（基于 SSH 协议）                                                 |
| **安全文件传输**   | 替代 FTP/SCP，安全上传 / 下载文件       | `scp`、`sftp` 或图形化工具（如 FileZilla 通过 SSH 通道）                                                |
| **端口转发（隧道）** | 突破网络限制访问内网服务（如数据库、Web 应用）    | 本地转发：`ssh -L 8080:localhost:80 user@server`  <br>动态转发（SOCKS 代理）：`ssh -D 1080 user@server` |
| **跳板机（堡垒机）** | 通过中间服务器间接访问内部服务器，增强安全审计      | JumpServer、Teleport 等堡垒机系统                                                                |
| **开发协作**     | 连接远程开发环境（如云服务器、Docker 容器）    | VS Code Remote - SSH 插件、JetBrains IDE 的远程开发功能                                             |
#### 服务在使用或者安装中遇到过什么问题
|问题类型|具体表现|可能原因|解决方案|
|---|---|---|---|
|**连接失败**|无法通过`ssh`命令连接服务器|1. 服务器 SSH 服务未启动（`systemctl status sshd`）  <br>2. 防火墙阻止 22 端口（`ufw allow 22`）  <br>3. 服务器 IP 或端口配置错误|1. 启动 SSH 服务：`systemctl start sshd`  <br>2. 开放防火墙：`sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT`  <br>3. 检查配置文件：`/etc/ssh/sshd_config`|
|**密钥认证失败**|使用密钥登录时提示`Permission denied`|1. 公钥未正确添加到服务器`~/.ssh/authorized_keys`  <br>2. 密钥文件权限错误（私钥权限需为 600）  <br>3. 密钥类型不匹配（如 RSA vs ECDSA）|1. 重新生成密钥：`ssh-keygen -t rsa`  <br>2. 复制公钥到服务器：`ssh-copy-id user@server`  <br>3. 检查权限：`chmod 600 ~/.ssh/id_rsa`|
|**慢连接或卡顿**|连接响应缓慢或操作延迟|1. DNS 反向解析超时（`GSSAPIAuthentication no`）  <br>2. 网络质量差  <br>3. 服务器负载过高|1. 修改配置：`/etc/ssh/sshd_config` 添加 `UseDNS no`  <br>2. 使用`mosh`（Mobile Shell）替代 SSH，支持断网续连|
|**端口占用冲突**|无法在标准 22 端口启动 SSH 服务|1. 其他服务占用 22 端口（如 Telnet）  <br>2. 多 SSH 服务实例冲突|1. 修改 SSH 端口：`/etc/ssh/sshd_config` 中将`Port 22`改为其他端口（如 2222）  <br>2. 重启服务：`systemctl restart sshd`|
|**中间人攻击风险**|首次连接提示`REMOTE HOST IDENTIFICATION HAS CHANGED!`|1. 服务器密钥被重置  <br>2. 中间人攻击（需高度警惕）|1. 手动删除旧密钥：`ssh-keygen -R [server_ip]`  <br>2. 联系管理员确认服务器公钥指纹|
#### 服务的其他使用场景是什么 (在别的公司如何用）
|行业|特色应用场景|技术实现|
|---|---|---|
|**金融 / 证券**|1. 加密传输交易数据  <br>2. 通过 SSH 隧道访问内部交易系统  <br>3. 堡垒机集中审计所有运维操作|1. 自定义 SSH 端口（如 2222）+ TLS 加密  <br>2. 与 LDAP/AD 集成实现用户认证  <br>3. 日志审计工具（如 ELK Stack）收集 SSH 会话记录|
|**互联网企业**|1. 大规模集群自动化部署（Kubernetes 节点管理）  <br>2. Git 代码仓库管理（如 GitLab 基于 SSH 协议）|1. 使用 Ansible/Puppet 通过 SSH 批量配置服务器  <br>2. Git 客户端通过 SSH 协议推送 / 拉取代码：`git clone git@github.com:user/repo.git`|
|**教育 / 科研**|1. 远程访问高性能计算集群（HPC）  <br>2. 学生远程实验室环境管理|1. 通过 SSH 连接超级计算机执行计算任务  <br>2. JupyterHub 通过 SSH 认证学生账户并分配计算资源|
|**制造业**|1. 远程维护工业控制系统（PLC、SCADA）  <br>2. 加密传输生产数据|1. 通过 SSH 网关安全访问生产网络  <br>2. 结合 VPN 和 SSH 实现工控设备的远程运维|
|**云服务提供商**|1. 提供 SSH 密钥对管理界面（如 AWS EC2 控制台）  <br>2. 基于 SSH 的容器远程调试|1. 用户通过控制台生成 SSH 密钥并绑定到云服务器  <br>2. Docker 通过 SSH 远程 API 管理容器：`docker -H ssh://user@server ps`|
#### 目前我们用的版本号什么，有哪些版本，最新版本号更新到什么程度，各个版本有什么异同

SSH 协议有两个主要版本，当前主流使用**SSH-2.0**：

| 协议版本      | 特点                                                                            | 安全性         | 现状                 |
| --------- | ----------------------------------------------------------------------------- | ----------- | ------------------ |
| **SSH-1** | 1995 年发布，早期版本  <br>2. 存在安全漏洞（如缓冲区溢出）  <br>3. 加密算法单一（如 DES）                    | 低（已被破解）     | 已淘汰，现代 SSH 服务器默认禁用 |
| **SSH-2** | 2006 年标准化（RFC 4251-4254）  <br>2. 修复 SSH-1 安全缺陷  <br>3. 支持多种加密算法（AES、ChaCha20） | 高（持续更新加密机制） |                    |
#### OpenSSH 版本（开源 SSH 实现）

- **最新稳定版**：OpenSSH 9.5p1（2023 年 12 月发布）
- **主流 Linux 发行版默认版本**：
    - Ubuntu 22.04：OpenSSH 8.9p1
    - CentOS 8：OpenSSH 8.0p1
    - macOS Sonoma：OpenSSH 9.3p2

#### 版本差异（以 OpenSSH 为例）

| 版本      | 关键特性                                                        | 安全增强                                            |
| ------- | ----------------------------------------------------------- | ----------------------------------------------- |
| **8.x** | 1. 支持 ChaCha20-Poly1305 加密算法（移动设备优化）  <br>2. 引入证书认证（SSH CA） | 禁用弱密码哈希（如 MD5）  <br>2. 修复 CVE-2016-0777（认证绕过漏洞） |
| **9.x** | 1. 默认禁用 RSA-1024 密钥（强度不足）  <br>2. 支持量子抗性密钥交换（实验性）           | 修复 CVE-2023-38408（拒绝服务漏洞）  <br>2. 强化密钥生成随       |
#### 这个服务或者软件有哪些常见的模块 服务的日志，服务的数据都是如何处理的

SSH 服务（以 OpenSSH 为例）由多个独立模块组成：

|模块 / 组件|功能描述|配置文件 / 路径|
|---|---|---|
|**sshd**|SSH 服务器守护进程，监听 22 端口接收客户端连接|`/etc/ssh/sshd_config`（配置文件）  <br>`/usr/sbin/sshd`（二进制文件）|
|**ssh**|SSH 客户端命令行工具，用于发起远程连接|`/usr/bin/ssh`|
|**scp/sftp**|基于 SSH 的文件传输工具|`/usr/bin/scp`  <br>`/usr/lib/openssh/sftp-server`|
|**密钥管理**|生成 / 管理密钥对（如`ssh-keygen`）|私钥：`~/.ssh/id_rsa`  <br>公钥：`~/.ssh/id_rsa.pub`  <br>授权公钥：`~/.ssh/authorized_keys`|
|**认证模块**|实现密码认证、公钥认证、GSSAPI 认证等|PAM 模块：`/etc/pam.d/sshd`|
|**加密库**|提供加密算法支持（如 OpenSSL、libcrypto）|依赖系统加密库（如`/lib/x86_64-linux-gnu/libcrypto.s`|

#### 服务的升级是怎么做的，每个版本都有哪些相应的漏洞
SSH 服务的升级需根据操作系统（如 Linux、Windows）和具体实现（如 OpenSSH、Dropbear）选择对应方式，核心是替换旧版本程序并保留配置，步骤如下：

- **Linux 系统（以 OpenSSH 为例）**：
    - 通过包管理器升级（推荐）：  
        如 Ubuntu/Debian 使用 `sudo apt update && sudo apt upgrade openssh-server openssh-client`，CentOS/RHEL 使用 `sudo yum update openssh-server openssh-clients`，自动处理依赖并保留配置。
    - 源码编译升级：  
        下载对应版本源码（如[OpenSSH 官网](https://www.openssh.com/)），解压后执行 `./configure && make && sudo make install`，需手动处理依赖（如 OpenSSL），适合需要定制化的场景。
- **Windows 系统（以 PuTTY/OpenSSH 为例）**：
    - PuTTY 等客户端直接下载最新版本安装包覆盖安装；
    - 微软 OpenSSH 服务可通过 `winget upgrade` 或手动下载 MSI 包升级。
- **升级注意事项**：
    - 升级前备份配置文件（如 `/etc/ssh/sshd_config`）和密钥；
    - 升级后重启服务（如 `sudo systemctl restart sshd`），并验证连接是否正常；
    - 对于生产环境，建议先在测试环境验证兼容性。
#### 这个服务可以与哪些服务结合有意想不到的功能或者解决方案

1. **与端口转发结合：构建加密通道**
- **场景**：通过 SSH 端口转发（本地转发、远程转发、动态转发）加密传输其他协议（如 HTTP、MySQL、VNC）的数据，解决明文传输安全问题。

2. 与文件传输服务结合：替代 FTP/SCP
- **场景**：SSH 自带的`sftp`和`scp`可替代不安全的 FTP，结合`rsync`实现增量加密备份。

3. 与隧道服务结合：搭建虚拟私有网络（VPN）

- **场景**：通过 SSH 隧道模拟 VPN，访问内网服务（如数据库、OA 系统）。
- **示例**：  
    本地机器通过 `ssh -fN -L 3306:db-server:3306 user@jump-server` 连接跳板机，将内网数据库（db-server:3306）映射到本地 3306 端口，直接通过本地客户端访问内网数据库，无需单独部署 VPN。

4. 与自动化工具结合：批量管理服务器

- **场景**：结合 Ansible、SaltStack 等工具，通过 SSH 协议批量执行命令、部署配置，替代手动登录操作。

 5. 与容器 / 云服务结合：管理隔离环境

- **场景**：在 Docker、Kubernetes 或云服务器（如 AWS EC2）中，通过 SSH 访问容器或实例内部，解决网络隔离问题。
- **示例**：
    - 对 Docker 容器：`docker exec -it <container> /bin/bash` 需容器运行 SSH 服务，或通过 `ssh -i key.pem user@container-ip` 直接访问；
    - 对 K8s Pod：通过 `kubectl port-forward pod/<pod-name> 2222:22` 映射 SSH 端口到本地，再用`ssh localhost -p 2222` 访问。
 6. 与日志 / 监控服务结合：安全传输数据

- **场景**：通过 SSH 隧道将服务器日志、监控指标（如 Prometheus 数据）加密传输到管理节点，避免明文泄露。
- **解决方案**：  
    配置 Logstash 通过 SSH 隧道连接远程服务器，或使用`rsync over ssh`定期同步日志文件到分析服务器，确保数据在传输中不被篡改。

#### 从安全的角度来考虑这个软件是否安全或者需要在哪里调优？

  - **权限过度开放**：默认允许 root 直接登录，若密钥或密码泄露，攻击者可直接获取最高权限。
  - **日志审计缺失**：默认日志记录较简单，若未配置详细审计，攻击行为可能无法追溯。
  - **端口暴露风险**：默认使用 22 端口，易成为扫描和攻击目标（如暴力破解）。
  - **算法漏洞**：部分旧版本支持不安全的加密算法（如 DES、MD5）或密钥交换算法（如 diffie-hellman-group1-sha1），可能被破解。